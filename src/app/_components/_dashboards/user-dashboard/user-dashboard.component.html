<!--
File: c:\Users\tonyw\Desktop\WoRTool NG\ng-paapp2\src\app\board-user\board-user.component.html
Project: c:\Users\tonyw\Desktop\WoRTool NG\ng-paapp2
Created Date: Sunday August 6th 2023
Author: Tony Wiedman
-----
Last Modified: Thu February 15th 2024 7:53:24 
Modified By: Tony Wiedman
-----
Copyright (c) 2023 Tone Web Design, Molex
-->
<div *ngIf="loading" class="text-center">
	<div class="lds-ellipsis">
		<div></div>
		<div></div>
		<div></div>
		<div></div>
	</div>
</div>



<div *ngIf="!loading"
	class="container mx-auto md:px-[2em] mt-[1em] lg:mt-[2em] mb-[5em]">





	<div *ngIf="isLoggedIn">

		<div class="grid lg:grid-cols-[auto_1fr] lg:gap-2 grid-cols-1">

				<div class="bg-[#1e293b]/80 rounded-sm ring-2 ring-[#28364d]/70 shadow-xl w-full py-1 h-fit">
					<mat-list>
						<mat-action-list>
							<button routerLinkActive="active_btn"
								routerLink="/user/1"
								mat-list-item
								class="!px-8 !text-neutral-300 !h-[55px] flex items-center">
								<i class="fa-solid fa-key !text-white"></i>
								Change Password
							</button>
							<mat-divider></mat-divider>
							<button routerLinkActive="active_btn"
								routerLink="/user/2"
								mat-list-item
								class="!px-8 !text-neutral-300 !h-[55px] flex items-center">
								<i class="fa-solid fa-circle-nodes !text-white"></i>
								Profile & Accounts
							</button>
							<mat-divider></mat-divider>
							<button routerLinkActive="active_btn"
								routerLink="/user/3"
								mat-list-item
								class="!px-8 !text-neutral-300 !h-[55px] flex items-center">
								<i class="fa-solid fa-star !text-white"></i>
								Manage Favorites
							</button>
						</mat-action-list>
					</mat-list>
				</div>
		





				<div class="lg:ml-5 w-full mt-[1em] lg:mt-[unset]">
				<div *ngIf="showPage1"
					class="w-full bg-[#1e293b]/80 rounded-sm ring-2 ring-[#28364d]/70 shadow-xl p-6 scale-center">
					<h2 class="text-2xl text-[#94a3b8] mb-[1em] ml-2 lg:ml-0">Change Password</h2>
					<form (ngSubmit)="updatePassword()">
						<div class="form-group m-4">




							<div class="field-box">
								<input [(ngModel)]="passwordCurrent"
									name="passwordCurrent"
									
									class="field-input my-[0.5em]"
									type="password"
									placeholder="Current Password...">
								<i class="fa-solid fa-key field-icon"></i>
							</div>




							<div class="field-box">
								<input [(ngModel)]="passwordNew"
									name="passwordNew"
									
									class="field-input my-[0.5em]"
									type="password"
									placeholder="New Password...">
								<i class="fa-solid fa-wand-magic-sparkles field-icon"></i>
							</div>




							<div class="field-box">
								<input [(ngModel)]="passwordNewConfirm"
									name="passwordNewConfirm"
									
									class="field-input my-[0.5em]"
									type="password"
									placeholder="Confirm Password...">
								<i class="fa-solid fa-check field-icon"></i>
							</div>




						</div>

						<div class="w-full text-right">
						<button
							type="submit"
							mat-raised-button class="" color="primary">
							Update Password
						</button>
						</div>



					</form>





				</div>
				<div *ngIf="showPage2"
					class="w-full rounded-lg py-[1.5em] lg:px-[2em] px-3 mx-auto bg-[#1e293b]/80 scale-center">
					<h2 class="text-2xl text-[#94a3b8] mb-[1em] ml-2 lg:ml-0">Edit Profile</h2>
					<form (ngSubmit)="updateProfile()">




						<div class="form-group m-4">




							<div class="field-box">
								<input [(ngModel)]="email"
									name="email"
									
									class="field-input my-[0.5em]"
									type="email"
									value="{{currentUser.email}}"
									placeholder="Your email...">
								<i class="fa-solid fa-envelope field-icon"></i>
							</div>




							<div *ngIf="discordIsSynced"
								class="!hidden">
								<input [(ngModel)]="discordId"
									name="discordId"
									
									class="field-input my-[0.5em] !hidden"
									type="hidden"
									value="{{currentUser.discordId}}"
									placeholder="Your discord id..."
									disabled>


							</div>


							<div *ngIf="regimentSelected"
								class="">
								<input [(ngModel)]="regimentId"
									name="regimentId"
									
									class="field-input my-[0.5em]"
									type="hidden"
									value="{{currentUser.regimentId}}"
									placeholder="Your regiment id..."
									disabled>
							</div>
















							<div class="my-[1em] p-3 rounded-sm hover:opacity-70 transition-all duration-300">
								<span class="text-xl text-[#94a3b8]">Linked Accounts</span>


								<div class="grid sm:grid-cols-2 grid-cols-1">


									<div *ngIf="!discordIsSynced || !discordData"
										class="place-self-center">


										<button (click)="sync()"
											class="!mt-2"
											mat-stroked-button
											color="primary"
											type="button">
											<i class="fa-brands fa-discord"></i>
											Link Discord
										</button>
									</div>


									<div *ngIf="discordData">
										<div class="m-[1em] max-h-fit text-justify">
											<div class="text-base">Discord Account</div>


											<div class="grid grid-cols-[85px_minmax(auto,_1fr)] gap-2">


												<div>
													<img *ngIf="avatar_url; else noAvatar" [src]="avatar_url" (error)="avatar_url = null"
														class="h-[80px] mt-2 pointer-events-none">

													<ng-template #noAvatar>
														<img src="https://molex.cloud/2023/November/3/_vfF/error.png"
														class="h-[80px] mt-2 pointer-events-none">
													</ng-template>
												</div>


												<div>
													<div class="font-[200] text-sm text-justify">


														<span class="block text-base text-slate-300 my-2">
															{{
															discordData?.username }}
														</span>


														<i class="fa-brands fa-discord text-neutral-300"></i>
														{{discordData?.discordId}}
														<div class="cursor-pointer hover:opacity-80 mt-2">
															<span (click)="confirmUnSync()"
																class="text-red-400">
																<i class="fa-regular fa-circle-xmark"></i>
																Unlink
															</span>
														</div>


													</div>
												</div>
											</div>
										</div>
									</div>


									<div *ngIf="!regimentData || stillSelecting"
										class="place-self-center my-[4em]">
										<div>



											<select #selectBox
												[(ngModel)]="regimentId"
												(change)="updateRegiment()"
												name="regimentId"
												class="field-input text-base !inline-block hover:!scale-100 focus:!scale-100 !transition-none !h-[45px] !max-w-fit"
												id="select">
												<option value
													disabled
													selected>
													Join a Regiment
												</option>
												<option *ngFor="let regiment of allRegimentsList"
													[value]="regiment.id">
													{{ regiment.regiment }}
												</option>
											</select>



										</div>
									</div>



									<div *ngIf="regimentData && !stillSelecting">
										<div class="m-[1em] max-h-fit text-justify">
											<div class="text-base">Your Regiment</div>


											<div class="grid grid-cols-[85px_minmax(auto,_1fr)] gap-2">


												<div>
													<img [src]="regimentData?.guild_avatar"
														class="h-[80px] mt-2 pointer-events-none">
												</div>


												<div>
													<div class="font-[200] text-sm text-justify">


														<span class="block text-base text-slate-300 my-2">
															{{ regimentData?.regiment }}
														</span>


														<i class="fa-brands fa-discord text-neutral-300"></i>
														{{regimentData?.guild_id}}
														<div class="cursor-pointer hover:opacity-80 mt-2">
															<span *ngIf="!regimentData.ownerId.includes(currentUser.discordId)" (click)="confirmUnSyncRegiment()"
																class="text-red-400">
																<i class="fa-regular fa-circle-xmark"></i>
																Unlink
															</span>
															<span *ngIf="regimentData.ownerId.includes(currentUser.discordId)"
																class="text-red-400/50 !cursor-not-allowed">
																<i class="fa-regular fa-circle-xmark"></i>
																Regiment Owner
															</span>
														</div>


													</div>
												</div>
											</div>
										</div>
									</div>



								</div>
							</div>










						</div>
						<div class="w-full text-right">
							<button
							type="submit"
							mat-raised-button class="" color="primary">
							Update Profile
						</button>
						</div>
						
					</form>







				</div>
				<!--  -->
				<div *ngIf="showPage3"
					class="w-full rounded-lg py-[1.5em] lg:px-[2em] px-3 mx-auto bg-[#1e293b]/80 scale-center">
					<h2 class="text-2xl text-[#94a3b8] ml-2 lg:ml-0">Manage Favorites</h2>





					<div *ngIf="currentFavorites"
						class="m-4 table-container">
						<mat-table [dataSource]="dataSource"
							matSort>
							<ng-container matColumnDef="map">
								<mat-header-cell *matHeaderCellDef>Map Name</mat-header-cell>
								<mat-cell *matCellDef="let fav"
									class="font-[400] text-neutral-100">





									<button [routerLink]="fav.route"
										class="!my-2"
										mat-stroked-button
										color="primary">
										{{fav.mapData.map}}
									</button>




								</mat-cell>
							</ng-container>





							<ng-container matColumnDef="route">
								<mat-header-cell *matHeaderCellDef></mat-header-cell>
								<mat-cell *matCellDef="let fav"
									class="actions-cell action-column">





									<button (click)="confirmDelete(fav.mapId, fav.mapData.map)"
										mat-button
										class="!text-[#9b3f3f] !font-[900] !mx-1">
										<i class="fa-solid fa-trash sm:pr-2"></i>
										<span class="hidden sm:inline">Delete</span>
									</button>
								</mat-cell>
							</ng-container>





							<mat-header-row *matHeaderRowDef="['map', 'route']"></mat-header-row>
							<mat-row *matRowDef="let row; columns: ['map', 'route'];"></mat-row>
						</mat-table>
						<p *ngIf="!hasFavorites"
							class="m-4 text-neutral-100">
							No favorites yet...
						</p>
						<mat-paginator [pageSizeOptions]="[5, 10, 20]"
							[pageSize]="pageSize"
							[showFirstLastButtons]="true"
							(page)="onPageSizeChange($event)"></mat-paginator>
					</div>
				</div>
			</div>
		</div>
	</div>





	<div *ngIf="!isLoggedIn"
		class="p-5 bg-[#1c2537] rounded-md"
		style="border-left: 5px solid #a13c3c;">
		<div class="grid grid-cols-1 sm:grid-cols-[120px_minmax(900px,_1fr)_100px] grid-rows-2 sm:grid-rows-none">
			<div class="row-start-2 sm:row-start-auto">
				<button class="!my-4 bg-gradient-to-tr from-[#4b4a48]/80 to-[#a3a197]/80 opacity-[65%] !transition !duration-300 ease-in hover:opacity-[80%]"
					mat-button
					routerLink="/home">
					<i class="fa-solid fa-house mr-1.5"></i>
					Home
				</button>
			</div>





			<div class="row-start-1 sm:row-start-auto">
				<h3 class="text-xl my-2">
					Please login to continue
				</h3>
				<p>
					You must be logged in to access this content.
				</p>
			</div>
		</div>




	</div>
</div>
