<div class="container mx-auto mt-[1em] scroll-container mb-[4em]">

    <div *ngIf="!isLoaded" class="lds-ellipsis">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div>

    <div *ngIf="isLoaded" class="grid md:grid-cols-[auto_1fr] gap-2 md:gap-6">
        <div class="p-2 rounded-sm ring-2 ring-[#28364d]/70 shadow-xl h-fit md:sticky md:top-[5em]">
            <!-- Filter By Artillery -->
            <div class="text-[#88887b] md:text-lg font-[500] text-base tracking-tight overflow-hidden whitespace-nowrap text-overflow: ellipsis;" style="max-width: 100%;">Filter By Artillery</div>
            <label class="font-[200] text-neutral-200">
                <input type="checkbox" [(ngModel)]="csaArtillery" (change)="filterMaps()"> CSA Artillery
            </label>
    
            <label class="font-[200] text-neutral-200">
                <input type="checkbox" [(ngModel)]="usaArtillery" (change)="filterMaps()"> USA Artillery
            </label>

            <!-- Filter by Campaign -->
            <div class="text-[#88887b] md:text-lg font-[500] text-base tracking-tight overflow-hidden whitespace-nowrap mt-2">Filter By Campaign</div>
            <div *ngFor="let campaign of uniqueCampaigns">
            <label class="font-[200] text-neutral-200">
                <input type="checkbox" [(ngModel)]="selectedCampaigns[campaign]" (change)="filterMaps()"> {{ campaign }}
            </label>
            </div>

    
          <!-- Filter by Weapons, Grouped by Type -->
            <div class="text-[#88887b] text-lg font-[500] tracking-tight overflow-hidden whitespace-nowrap mt-2" style="max-width: 100%;text-overflow: ellipsis;">Filter By Weapons</div>
            <div *ngFor="let type of objectKeys(weaponsGroupedByType)">
            <div class="text-[#94a3b8]/80 text-base tracking-tight font-[400] mt-1"
            style="filter: drop-shadow(2px 0px 6px #2e3f5998);">{{ type }}</div>
            <div *ngFor="let weapon of weaponsGroupedByType[type]">
                <label class="font-[200] text-neutral-200">
                <input type="checkbox" [(ngModel)]="selectedWeapons[weapon.weapon]" (change)="filterMaps()"> {{ weapon.weapon }}
                </label>
            </div>
            </div>



            <!-- Filter by Favorites -->
            <div class="text-[#88887b] md:text-lg font-[500] text-base tracking-tight overflow-hidden whitespace-nowrap mt-2" style="max-width: 100%;text-overflow: ellipsis;">Filter By Favorites</div>
            <div>
                <label class="font-[200] text-neutral-200">
                    <input type="checkbox" [(ngModel)]="filterFavorites" (change)="filterMaps()"> {{this.sharedDataService.currentUser.username}}'s Favorites
                  </label>
            </div>

            <div class="text-[#88887b] md:text-lg font-[500] text-base tracking-tight overflow-hidden whitespace-nowrap mt-2" style="max-width: 100%;text-overflow: ellipsis;">Sort by</div>
            <div>
                <!-- Sorting Criterion Select Box -->
                <select class="sort-select" [(ngModel)]="sortBy" (change)="sortMaps()">
                  <option value="favorites">Sort by Favorites</option>
                  <option value="name">Sort Alphabetically</option>
                </select>
              
                <!-- Toggle Direction Button -->
                <button class="sort-button" (click)="toggleSortDirection(); sortMaps()">
                {{ sortDirection === 'ascending' ? 'ASC ↑' : 'DESC ↓' }}
                </button>
              </div>
              
        </div>
    
        <!-- Map Cards -->
        <div class="grid md:grid-cols-3 gap-8 w-full h-fit">
            <div *ngFor="let map of filteredMaps; let i = index">
                <div
                [@cardAnimation]="animationStates[i] || 'default'"
					(mouseenter)="onMouseEnter(i)"
					(mouseleave)="onMouseLeave(i)">
                    <div class="relative animate-load bg-[#1e293b]/80 rounded-sm ring-2 ring-[#28364d]/70 shadow-xl w-full py-2 grid grid-cols-[1fr_auto]">
               
                        <div class="col-start-1 col-span-1 pl-2 cursor-pointer" [routerLink]="['/maps-beta', map.id]">
                            <span style="filter: drop-shadow(2px 0px 6px rgba(125, 126, 116, 0.281));" 
                                    class="text-[#88887b] font-[500] text-base tracking-tight inline-block overflow-hidden whitespace-nowrap" style="max-width: 100%;text-overflow: ellipsis;">{{ map.name }}</span>
                        </div>
                        <div class="col-start-2 col-span-1 pr-2 cursor-pointer" [routerLink]="['/maps-beta', map.id]">
                            <span class="text-[#94a3b8]/80 text-base tracking-tight font-[300]"
                            style="filter: drop-shadow(2px 0px 6px #2e3f5998);">
                                {{ map.campaign }}
                            </span>
                        </div>
            
            
                        <div class="cols-start-1 col-span-2">
                            <div class="grid grid-cols-[1fr_auto] mb-2">
                                <div>
                                    <div [routerLink]="['/maps-beta', map.id]" class="rounded-sm shadow-md overflow-hidden relative cursor-pointer transition-all duration-300 w-full" style="height: 222px; opacity: 80%;">
                                        <img [src]="map.map_image" [alt]="map.name" class="rounded-bl-sm rounded-tl-sm w-full h-full object-cover brightness-[55%] sepia-[50%] blur-[0.5px] scale-100 hover:scale-110 transition-transform duration-300 active:scale-95" />
                                    </div>
                                </div>
                                
                                <div class="flex flex-col !justify-start items-center bg-slate-900/50 mr-[-1px] h-full">
                                    <button
                                        mat-button
                                        color="primary"
                                        [matBadge]="map.map_favorite_count"
                                        matBadgeColor="accent"
                                        matBadgeSize="small"
                                        matTooltip="Add to Favorites"
                                        (click)="toggleFavorite(map)"
                                        [ngClass]="{'fav-active': isFavorite(map)}"
                                        class="!text-[#7e7f74] !min-w-fit">
                                        <span *ngIf="isFavorite(map)"><i class="fa-solid fa-heart text-xl"></i></span>
                                        <span *ngIf="!isFavorite(map)"><i class="fa-regular fa-heart text-xl"></i></span>     
                                    </button>
    
    
                                    <div class="my-auto pb-[2em]">
                                        <div class="w-fit text-center bg-gray-800 p-1.5 rounded-sm m-0.5 cursor-help hover:opacity-80" 
                                        matTooltip="{{map.usa_infantry_regiments}} USA units, {{map.csa_infantry_regiments}} CSA units" matTooltipPosition="left">
                                            <img src="https://molex.cloud/2024/February/18/_Jzw/infantry.png" class="w-[22px] py-1 h-auto pointer-events-none mx-auto">
                                        </div>
    
                                        <div *ngIf="getBuckNBallSides(map)" class="w-fit text-center bg-gray-800 p-1.5 rounded-sm m-0.5 cursor-help hover:opacity-80"
                                        matTooltip="Buck 'N Ball ({{getBuckNBallSides(map)}})" matTooltipPosition="left">
                                        <img src="https://molex.cloud/2024/February/18/_kDg/bucknball.png" class="w-[22px] h-auto pointer-events-none mx-auto">
                                    </div>
    
                                        <div *ngIf="map.usa_artillery || map.csa_artillery" class="w-fit text-center bg-gray-800 p-1.5 rounded-sm m-0.5 cursor-help hover:opacity-80" 
                                        matTooltip="{{map.usa_artillery_regiments}} USA units, {{map.csa_artillery_regiments}} CSA units" matTooltipPosition="left">
                                            <img src="https://molex.cloud/2024/February/18/_cyG/artillery-icon.png" class="w-[22px] h-auto pointer-events-none mx-auto">
                                        </div>
    
                                        
                                    </div>
    
                                </div>
                            </div>
                            
                            
                        </div>
    
                        <div class="col-start-1 col-span-1 flex items-center pl-2 cursor-pointer" [routerLink]="['/maps-beta', map.id]">    
                            <span style="filter: drop-shadow(2px 0px 6px #c4c4c44f);" class="text-sm opacity-40">{{ map.attacker }} Attacker</span>
                        </div>
    
                        <div class="col-start-2 col-span-1 text-right pr-2 cursor-pointer" [routerLink]="['/maps-beta', map.id]">
                            <!-- <button [routerLink]="['/maps-beta', map.id]" mat-mini-fab color="primary" class=" !scale-75">
                                <mat-icon>search</mat-icon>
                            </button> -->
                        </div>
           
                    </div>
                </div>
                
            </div>
        </div>
        
        
    </div>

    

</div>