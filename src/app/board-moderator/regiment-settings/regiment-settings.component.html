<!--
File: c:\Users\tonyw\Desktop\WoRTool NG\ng-paapp2\src\app\board-moderator\regiment-settings\regiment-settings.component.html
Project: c:\Users\tonyw\Desktop\WoRTool NG\ng-paapp2
Created Date: Sunday July 2nd 2023
Author: Tony Wiedman
-----
Last Modified: Wed October 11th 2023 9:18:41 
Modified By: Tony Wiedman
-----
Copyright (c) 2023 Tone Web Design, Molex
-->

<div *ngIf="!isLoaded" class="lds-ellipsis">
	<div></div>
	<div></div>
	<div></div>
	<div></div>
</div>

<div *ngIf="isLoaded">



<div *ngIf="!isOwner">
	<p>This is reserved for regiment owners.</p>
</div>

<div *ngIf="isOwner">

	<div *ngIf="regimentData" class="max-w-full">
		<!-- <h2 class="text-2xl text-slate-400 pb-4 ml-2 lg:ml-0">Regimental Settings</h2> -->


		<mat-tab-group dynamicHeight>
			<!-- Settings Tab -->
			<mat-tab label="Settings">
				<h3 class="text-slate-300 ml-1 mt-6 text-xl font-[300]">
					Event Tool Settings
				</h3>
				<p class="text-sm font-[200] italic text-neutral-300 mt-2 mb-3 ml-4">
					<i class="fa-regular fa-circle-question mr-1"></i> Select the Discord channel where you'd like to
					share event server information using the event share tool.
				</p>

				<!-- Event Webhook Tool -->
				<div class="p-2 m-2 text-neutral-200 grid gap-4 sm:grid-cols-4 grid-cols-1">
					<div class="col-start-1 col-span-1">
						<h3 class="text-slate-400 ml-1">Event Channel</h3>
						<span *ngIf="regimentData.webhook_channel" [innerHTML]="regimentData.webhook_channel"
							class="px-3 p-1 m-1 block bg-slate-700 text-neutral-100 rounded-sm shadow-sm">
						</span>
						<span *ngIf="!regimentData.webhook_channel"
							class="px-3 p-1 m-1 block bg-slate-700 text-neutral-100 rounded-sm shadow-sm">
							No event channel selected.
						</span>
					</div>
					<!-- 	
					<div class="sm:col-start-2 col-span-1">
						<h3 class="text-slate-400">Webhook URL</h3>
						<span [innerHTML]="regimentData.webhook" class="px-3 p-1 m-1 block bg-slate-700 text-neutral-100 rounded-sm truncate shadow-sm"></span>
					</div>
	 				-->
					<div class="sm:col-start-3 sm:col-span-2 sm:place-self-end">
						<select #channelSelect style=" padding-top: 11px;
							padding-bottom: 11px;
							font-size: 15px;
							border: 1px solid #7c7d72 !important;" class="field-input2 inline-block" id="channel-select">
							<option value="0">Select a Channel</option>
							<option *ngFor="let channel of this.regimentChannels" [value]="channel.id">
								{{ channel.name }}
							</option>
						</select>

						<button (click)="updateTargetChannel(channelSelect.value)" mat-stroked-button
							class="ml-2 !w-[100px] !inline-block !py-[1.02em] !px-[0] !mb-1" color="primary">
							Set Channel
						</button>
					</div>
				</div>

				<!-- Update Regiment Form -->
				<h3 class="text-slate-300 ml-1 mt-6 text-xl font-[300]">
					{{regimentData.regiment}} Information
				</h3>
				<p class="text-sm font-[200] italic text-neutral-300 mt-2 mb-3 ml-4">
					<i class="fa-regular fa-circle-question mr-1"></i> Personalize your regiment's profile information.
				</p>

				<div class="">
					<form (ngSubmit)="updateRegiment()">
						<div class="form-group p-2 m-2">
							<div class="field-box">
								<input [(ngModel)]="regiment" name="regiment" style="
                padding-top: 11px;
                padding-bottom: 11px;
                font-size: 15px;
                border: 1px solid #7c7d72 !important;
              " class="field-input !font-[300] my-[0.5em]" type="text" placeholder="Display Name...">
								<i class="fa-solid fa-tag field-icon"></i>
							</div>

							<div class="field-box">
								<select [(ngModel)]="side" style=" padding-top: 8px;
    						padding-bottom: 8px;
    						font-size: 15px;
    						border: 1px solid #7c7d72 !important;" class="field-input2 inline-block my-2" id="side-select" name="side">
									<option value="regimentData.side" selected disabled>
										{{regimentData.side}}
									</option>
									<option value="USA">USA</option>
									<option value="USA">CSA</option>
								</select>
								<i class="fa-solid fa-arrows-up-down field-icon"></i>
							</div>

							<div class="field-box">
								<input [(ngModel)]="guild_id" name="guild_id" style="
                padding-top: 11px;
                padding-bottom: 11px;
                font-size: 15px;
                border: 1px solid #7c7d72 !important;
              " class="field-input !font-[300] my-[0.5em]" type="hidden" placeholder="Discord ID...">
							</div>

							<div class="field-box">
								<input [(ngModel)]="guild_avatar" name="guild_avatar" style="
                padding-top: 11px;
                padding-bottom: 11px;
                font-size: 15px;
                border: 1px solid #7c7d72 !important;
              " class="field-input !font-[300] my-[0.5em]" type="hidden" placeholder="Avatar Url...">
							</div>

							<div class="field-box">
								<input [(ngModel)]="invite_link" name="invite_link" style="
                padding-top: 11px;
                padding-bottom: 11px;
                font-size: 15px;
                border: 1px solid #7c7d72 !important;
              " class="field-input !font-[300] my-[0.5em]" type="text" placeholder="Invite Link...">
								<i class="fa-solid fa-link field-icon"></i>
							</div>

							<div class="field-box">
								<input [(ngModel)]="website" name="website" style="
                padding-top: 11px;
                padding-bottom: 11px;
                font-size: 15px;
                border: 1px solid #7c7d72 !important;
              " class="field-input !font-[300] my-[0.5em]" type="text" placeholder="Website...">
								<i class="fa-solid fa-globe field-icon"></i>
							</div>

							<div class="field-box">
								<textarea [(ngModel)]="description" name="description" style="
                padding-top: 11px;
                padding-bottom: 11px;
                font-size: 15px;
                border: 1px solid #7c7d72 !important;
              " class="field-input !font-[300] my-[0.5em] textarea" placeholder="Description...">
						</textarea>
								<i class="fa-solid fa-book field-icon"></i>
							</div>
						</div>

						<button mat-raised-button type="submit"
							class="w-full !mt-[0.5em] !py-2 !sm:py-[5px] sm:text-lg text-xl !bg-gradient-to-tr from-[#4b4a48]/80 to-[#a3a197]/80 opacity-[65%] !transition !duration-300 ease-in hover:opacity-[80%]">
							Update Regiment
						</button>
					</form>

				</div>
				<!--  -->
			</mat-tab>
			<mat-tab label="Members">

				<h3 class="text-slate-300 ml-1 mt-6 text-xl font-[300]">
					Manage Members &amp; Managers
				</h3>
				<p class="text-sm font-[200] italic text-neutral-300 mt-2 mb-3 ml-4">
					<i class="fa-regular fa-circle-question mr-1"></i> Add or remove members and managers from your
					regiment. If you would like to add more than one owner please direct message <b>.molex</b> on discord.
				</p>

				<div class="">

					<!-- Owner -->
					<h3 class="text-slate-300 ml-2 mt-6 text-base font-[300]">
						{{regimentData.regiment}} Owner

					</h3>

					<div *ngFor="let user of regimentUsers?.slice(0, 8)">
						
						<div *ngIf="regimentData.ownerId.includes(user.discordId);"
							class="bg-slate-900/80 rounded-lg my-2 mx-4 h-[45px] flex items-center">
					
								
								<img *ngIf="user.avatar_url; else noAvatar" [src]="user.avatar_url"
       								class="h-[45px] max-w-[50px] w-auto inline rounded-l-lg pr-2" (error)="user.avatar_url = null">

								<ng-template #noAvatar>
									<i class="fa-solid fa-user h-[25px] px-2"></i>
								</ng-template>

								<span class="text-lg font-[300] flex items-center">
									{{user.username}} <i class="ml-1 mb-[1px] fa-solid fa-crown text-amber-400"></i>
								</span>
					
						</div>

						<div class="grid grid-cols-[auto_1fr]">

						</div>
					</div>




					<!-- Managers -->
					<h3 class="text-slate-300 ml-2 mt-6 text-base font-[300]">{{regimentData.regiment}} Managers</h3>

					<div *ngFor="let user of regimentUsers?.slice(0, 8)">
						<div *ngIf="(!regimentData.ownerId.includes(user.discordId)) && user.roles.includes('ROLE_MODERATOR');"
							class="bg-slate-900/80 rounded-lg my-2 mx-4 h-[45px] flex items-center justify-between">
							<div class="flex items-center">
								
								<img *ngIf="user.avatar_url; else noAvatar" [src]="user.avatar_url"
       								class="h-[45px] max-w-[50px] w-auto inline rounded-l-lg pr-2">

								<ng-template #noAvatar>
									<i class="fa-solid fa-user h-[25px] px-2"></i>
								</ng-template>

								<span class="text-lg font-[300]">
									{{user.username}}
								</span>
							</div>

							<button mat-button class="!mr-2 !h-fit !min-h-fit !py-1" color="warn"
								(click)="confirmRemoveModerator(user.id)">
								<i class="fa-solid fa-minus"></i> Manager
							</button>
						</div>

						<div class="grid grid-cols-[auto_1fr]">

						</div>
					</div>



					<!-- Members -->
					<h3 class="text-slate-300 ml-2 mt-6 text-base font-[300]">{{regimentData.regiment}} Members</h3>

					<div *ngFor="let user of regimentUsers?.slice(0, 8)">
						<div *ngIf="(user.discordId != regimentData.ownerId) && !user.roles.includes('ROLE_MODERATOR');"
							class="bg-slate-900/80 rounded-lg my-2 mx-4 h-[45px] flex items-center justify-between">
							<div class="flex items-center">
								<img *ngIf="user.avatar_url; else noAvatar" [src]="user.avatar_url"
									class="h-[45px] w-auto inline rounded-l-lg pr-2">
								<ng-template #noAvatar>
									<i class="fa-solid fa-user h-[25px] px-2"></i>
								</ng-template>

								<span class="text-lg font-[300]">
									{{user.username}}
								</span>
							</div>

							<button mat-button class="!mr-2 !h-fit !min-h-fit !py-1" color="primary"
								(click)="confirmAddModerator(user.id)">
								<i class="fa-solid fa-plus"></i> Manager
							</button>
						</div>

						<div class="grid grid-cols-[auto_1fr]">

						</div>
					</div>

				</div>
			</mat-tab>
			<mat-tab label="Schedule">
				<h3 class="text-slate-300 ml-1 mt-6 text-xl font-[300]">
					Manage Regimental Schedules
				</h3>
				<p class="text-sm font-[200] italic text-neutral-300 mt-2 mb-3 ml-4">
					<i class="fa-regular fa-circle-question mr-1"></i> Publish and update your schedule for viewing on
					regimental profiles.
				</p>


				<div class="grid grid-cols-2 w-full">
					<div>

					</div>
					<div class="text-right">
						<button *ngIf="!creatingSchedule" mat-stroked-button color="primary" (click)="createSchedule()"><i class="fa-solid fa-plus"></i> New Schedule</button>
					</div>
				</div>
				

				<mat-divider *ngIf="!creatingSchedule" class="!my-2"></mat-divider>

				<div *ngIf="scheduleCount <= 0">
					<div class="bg-slate-900/80 rounded-md border-l-4 border-red-700 text-red-300 p-4">
						<div class="flex">
						  <div class="mr-2">
							<i class="fas fa-exclamation-triangle"></i>
						  </div>
						  <div>
							<p>No schedules found.</p>
						  </div>
						</div>
					  </div>
				</div>

				<!-- Choose a Schedule -->
				<div *ngIf="!creatingSchedule" class="w-full grid lg:grid-cols-3">
					<div *ngFor="let scheduleName of objectKeys(scheduleNames)" class="grid grid-rows-auto gap-4 p-4 m-2 bg-slate-900/80 rounded-sm shadow-md">
					  <div class="row-start-1 row-span-1">
						<h3 class="text-slate-300 text-base font-[600]"><i class="fa-solid fa-calendar-days"></i> {{scheduleName}}</h3>
						<p class="font-[300] text-neutral-200">{{scheduleCounts[scheduleName]}} slots in schedule</p>
					  </div>
					  <div class="row-start-2 row-span-1 text-right">
						<button mat-stroked-button (click)="selectSchedule(scheduleName)"><i class="fa-solid fa-pen-to-square"></i> Edit</button>
					  </div>
					</div>
				  </div>
				  
				<mat-divider *ngIf="!creatingSchedule" class="!my-2"></mat-divider>
				


				<!-- Editing Schedule -->
				<div *ngIf="editingSchedule">
					<div *ngIf="selectedScheduleName">

						


						<div class="w-full grid lg:grid-cols-2 gap-4">
							<div class="col-start-1 col-span-1">
								<h3 class="text-slate-300 ml-1 mt-6 text-xl font-[300]"><i class="fa-solid fa-pencil"></i> Editing {{selectedScheduleName}}</h3>

								<p class="text-sm font-[200] italic text-neutral-300 mt-2 mb-3 ml-4">
									<i class="fa-regular fa-circle-question mr-1"></i> Add or remove schedule slots from your calendar.
								</p>
							</div>
							

							<div class="text-right place-self-end ">

								<button mat-stroked-button color="primary" (click)="toggleTimeFormat()" class="!inline-block">
									<i class="fa-solid fa-clock pr-1"></i> {{timeString}}
								</button>

								<button *ngIf="editingSchedule" mat-flat-button (click)="cancelEdit()" class="!inline-block !ml-2" style="color: rgb(219, 213, 188) !important;"><i
									class="fa-solid fa-pen-to-square"></i> Cancel</button>
							</div>
						</div>
						

						<div class="w-full grid grid-cols-7 gap-2 hidden lg:grid mt-4">
							<ng-container *ngFor="let day of ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']; let i = index">
							  <div class="col-start-{{i + 1}} col-span-1">
								<div class="text-center bg-gray-500 p-2 rounded-sm shadow-md">{{ day }}</div> <!-- Header -->
								<ng-container *ngFor="let schedule of filterSchedulesByDay(day)">
									
									<div class="grid grid-rows-[1fr_auto] my-2 p-4 w-full bg-slate-700 shadow-md rounded-sm text-base font-[200]">
										<div style="overflow: hidden;">
										  <h1 class="text-neutral-200 text-lg event-type font-[400]">{{ schedule.event_type }}</h1>
										  {{ display12HourTime ? schedule.time12 : schedule.time24 }}
										</div>
										<div class="row-start-2 text-right">
										  <button (click)="removeDay(schedule.id)" mat-button class="!min-h-fit !h-fit !w-fit !min-w-fit" color="warn">
											<i class="fa-solid fa-trash-can !text-red-700"></i>
										  </button>
										</div>
									  </div>
									  
									  
									  
								</ng-container>
							  </div>
							</ng-container>
						  </div>
						  
						  <div class="lg:hidden mt-4">
							<!-- List view for mobile -->
							<ng-container *ngFor="let day of ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']">
							  <ng-container *ngIf="filterSchedulesByDay(day).length > 0">
								<div>
								  <div class="text-center bg-gray-400 p-2">{{ day }}</div> <!-- Header for mobile -->
								  <ng-container *ngFor="let schedule of filterSchedulesByDay(day)">
									<div class="m-2 p-2 bg-slate-700 shadow-md rounded-sm text-base">
										<div style="overflow: hidden;">
											<h1 class="text-neutral-200 text-lg event-type font-[400]">{{schedule.event_type}}</h1> {{ display12HourTime ? schedule.time12 : schedule.time24}}
										</div>
									  <div class="text-right">
										<button (click)="removeDay(schedule.id)" mat-button class="!min-h-fit !h-fit !w-fit !min-w-fit !p-2 !mx-1" color="warn"><i class="fa-solid fa-trash-can !text-red-700"></i></button>
									  </div>
									</div>
								  </ng-container>
								</div>
							  </ng-container>
							</ng-container>
						  </div>
						  
						  
						  
						
	
						
	
	
						<h1 class="text-slate-300 ml-1 mt-4 text-xl font-[300]">Add a Time Slot</h1>
	
						<div class="lg:p-4">
							<form (ngSubmit)="addDay()">


								<div class="field-box my-2">
									<select [(ngModel)]="scheduleForm.day"
										name="day"
										style="
							padding-top: 11px;
							padding-bottom: 11px;
							font-size: 15px;
							border: 1px solid #7c7d72 !important;" 
										class="field-input text-xl !inline-block hover:!scale-100 focus:!scale-100 !transition-none"
										id="existing-select">
										<option value
											disabled
											selected>
											Calendar Day...
										</option>
										<option value="Monday">Monday</option>
										<option value="Tuesday">Tuesday</option>
										<option value="Wednesday">Wednesday</option>
										<option value="Thursday">Thursday</option>
										<option value="Friday">Friday</option>
										<option value="Saturday">Saturday</option>
										<option value="Sunday">Sunday</option>
									</select>
									<i class="fa-solid fa-calendar-day field-icon"></i>
								</div>
		
		
								<div class="field-box my-2">
									<input [(ngModel)]="scheduleForm.time"
										name="time"
										style="
							padding-top: 11px;
							padding-bottom: 11px;
							font-size: 15px;
							border: 1px solid #7c7d72 !important;" 
										class="field-input"
										type="time">
										<i class="fa-regular fa-clock field-icon"></i>
								</div>
	
								<div class="field-box my-2">
									<input [(ngModel)]="scheduleForm.event_type"
										name="event_type"
										style="
							padding-top: 11px;
							padding-bottom: 11px;
							font-size: 15px;
							border: 1px solid #7c7d72 !important;" 
										class="field-input"
										placeholder="Event Name..."
										type="text">
										<i class="fa-solid fa-spell-check field-icon"></i>
								</div>
		
								<div class="text-right">
									<button mat-stroked-button type="submit">Add Time Slot</button>
								</div>
								

							</form>
						</div>
	
					</div>
				</div>
				


				<!-- Create New Schedule Form -->
				<div *ngIf="creatingSchedule">
					<form (ngSubmit)="createSchedule()">
						<button mat-stroked-button (click)="cancelEdit()" class="!inline-block"><i
							class="fa-solid fa-pen-to-square"></i> Cancel</button>
						<label>
							Schedule Name:
							<input [(ngModel)]="scheduleForm.schedule_name" name="schedule_name">
						</label>

						<label>
							Day:
							<select [(ngModel)]="scheduleForm.day" name="day">
								<option value="Monday">Monday</option>
								<option value="Tuesday">Tuesday</option>
								<option value="Wednesday">Wednesday</option>
								<option value="Thursday">Thursday</option>
								<option value="Friday">Friday</option>
								<option value="Saturday">Saturday</option>
								<option value="Sunday">Sunday</option>
							</select>
						</label>

						<label>
							Time:
							<input [(ngModel)]="scheduleForm.time" name="time" type="time">
						</label>

						<label>
							Event Type:
							<input [(ngModel)]="scheduleForm.event_type" name="event_type">
						</label>

						<button type="submit">Submit</button>
					</form>
				</div>

			</mat-tab>
		</mat-tab-group>


		<div>

		</div>
	</div>

</div>

</div>