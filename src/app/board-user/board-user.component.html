<div *ngIf="loading"
	class="text-center text-xl opacity-75">
	<i class="fas fa-spinner fa-pulse mr-2"></i>
	Verifying credentials...
</div>



<div *ngIf="!loading"
	class="lg:w-[69vw] w-[100vw - 2em] m-auto mt-[1em] lg:mt-[4em] mb-[5em]">



	<div *ngIf="isLoggedIn">



		<button routerLink="/home"
			mat-button
			color="primary"
			class="!mb-[1em]">
			<i class="fa-sharp fa-solid fa-arrow-left"></i>
			Back
		</button>


		<div class="grid lg:grid-cols-3 lg:gap-4 grid-cols-1">
			<div class="col-span-1 bg-slate-800/80 rounded-lg shadow-md h-fit w-full">
				<div class="my-2">
					<mat-list>
						<mat-action-list>
							<button routerLinkActive="active_btn"
								routerLink="/user/1"
								mat-list-item
								class="py-2 !text-neutral-300 !h-[55px]">
								<i class="fa-solid fa-key w-[25px] ml-[1.5em] mr-[0.5em] !text-white"></i>
								Change Password
							</button>
							<mat-divider></mat-divider>
							<button routerLinkActive="active_btn"
								routerLink="/user/2"
								mat-list-item
								class="py-2 !text-neutral-300 !h-[55px]">
								<i class="fa-solid fa-user-pen w-[25px] ml-[1.5em] mr-[0.5em] !text-white"></i>
								Profile Information
							</button>
							<mat-divider></mat-divider>
							<button routerLinkActive="active_btn"
								routerLink="/user/3"
								mat-list-item
								class="py-2 !text-neutral-300 !h-[55px]">
								<i class="fa-solid fa-stars w-[25px] ml-[1.5em] mr-[0.5em] !text-white"></i>
								Manage Favorites
							</button>
						</mat-action-list>
					</mat-list>
				</div>
			</div>



			<div class="lg:col-span-2 col-span-1 lg:ml-5 w-full mt-[1em] lg:mt-[unset]">
				<div *ngIf="showPage1"
					class="w-full rounded-lg py-[1.5em] lg:px-[2em] px-3 mx-auto bg-slate-800/80 scale-center">
					<h2 class="text-2xl text-slate-400 mb-[1em] ml-2 lg:ml-0">Change Password</h2>
					<form (ngSubmit)="updatePassword()">
						<div class="form-group m-4">


							<div class="field-box">
								<input [(ngModel)]="passwordCurrent"
									name="passwordCurrent"
									class="field-input my-[0.5em]"
									type="password"
									placeholder="Current Password...">
								<i class="fa-regular fa-key-skeleton field-icon"></i>
							</div>


							<div class="field-box">
								<input [(ngModel)]="passwordNew"
									name="passwordNew"
									class="field-input my-[0.5em]"
									type="password"
									placeholder="New Password...">
								<i class="fa-sharp fa-regular fa-sparkles field-icon"></i>
							</div>


							<div class="field-box">
								<input [(ngModel)]="passwordNewConfirm"
									name="passwordNewConfirm"
									class="field-input my-[0.5em]"
									type="password"
									placeholder="Confirm Password...">
								<i class="fa-sharp fa-regular fa-check field-icon"></i>
							</div>


						</div>


						<button mat-raised-button
							type="submit"
							class="w-full !mt-[0.5em] !py-2 !sm:py-[5px] sm:text-lg text-xl bg-gradient-to-tr from-[#4b4a48]/80 to-[#a3a197]/80 opacity-[65%] !transition !duration-300 ease-in hover:opacity-[80%]">
							Update Password
						</button>


					</form>



				</div>
				<div *ngIf="showPage2"
					class="w-full rounded-lg py-[1.5em] lg:px-[2em] px-3 mx-auto bg-slate-800/80 scale-center">
					<h2 class="text-2xl text-slate-400 mb-[1em] ml-2 lg:ml-0">Edit Profile</h2>
					<form (ngSubmit)="updateProfile()">


						<div class="form-group m-4">


							<div class="field-box">
								<input [(ngModel)]="email"
									name="email"
									class="field-input my-[0.5em]"
									type="email"
									value="{{currentUser.email}}"
									placeholder="Your email...">
								<i class="fa-sharp fa-regular fa-envelope field-icon"></i>
							</div>



							<div class="field-box">
								<input [(ngModel)]="avatar_url"
									name="avatar_url"
									class="field-input my-[0.5em]"
									type="email"
									value="{{currentUser.avatar_url}}"
									placeholder="Avatar url...">
								<i class="fa-sharp fa-regular fa-camera-retro field-icon"></i>
							</div>



							<div class="field-box">
								<input [(ngModel)]="discordId"
									(input)="updateDiscordSyncUrl()"
									name="discordId"
									class="field-input my-[0.5em]"
									type="email"
									value="{{currentUser.discordId}}"
									placeholder="Your discord id...">
								<i class="fa-brands fa-discord field-icon"></i>
							</div>




							<div *ngIf="discordId"
								class="field-box my-[1em] ring-2 ring-[#7c7d72] p-3 rounded-sm shadow-md hover:opacity-70 transition-all duration-300">
								<div class="grid gap-2 grid-cols-[105px_minmax(300px,_1fr)]">
									<div class="col-start-1 col-span-1">
										<img [src]="guild_avatar_url"
											class="h-[100px] w-auto">
									</div>
									<div class="col-start-2 col-span-1">
										<p>
											Pennsylvania Army
											<span class="font-thin block">
												(681641606398607401)
											</span>
										</p>
										<button (click)="sync(discordSyncUrl)"
											class="!mt-2"
											mat-stroked-button
											color="primary"
											type="button">
											Discord Sync
										</button>
									</div>
								</div>



								<!-- <p class="font-[200]" [innerHTML]="discordSyncUrl"></p> -->



							</div>




						</div>
						<button mat-raised-button
							type="submit"
							class="w-full !mt-[1em] !py-2 !sm:py-[5px] sm:text-lg text-xl bg-gradient-to-tr from-[#4b4a48]/80 to-[#a3a197]/80 opacity-[65%] !transition !duration-300 ease-in hover:opacity-[80%]">
							Update Profile
						</button>
					</form>





				</div>
				<!--  -->
				<div *ngIf="showPage3"
					class="w-full rounded-lg py-[1.5em] lg:px-[2em] px-3 mx-auto bg-slate-800/80 scale-center">
					<h2 class="text-2xl text-slate-400 ml-2 lg:ml-0">Manage Favorites</h2>



					<div *ngIf="currentFavorites"
						class="m-4 table-container">
						<mat-table [dataSource]="dataSource"
							matSort>
							<ng-container matColumnDef="map">
								<mat-header-cell *matHeaderCellDef>Map Name</mat-header-cell>
								<mat-cell *matCellDef="let fav"
									class="font-[400] text-neutral-100">



									<button [routerLink]="fav.route"
										mat-stroked-button
										color="primary">
										{{fav.mapData.map}}
									</button>


								</mat-cell>
							</ng-container>



							<ng-container matColumnDef="route">
								<mat-header-cell *matHeaderCellDef
									class="action-column-header">
								</mat-header-cell>
								<mat-cell *matCellDef="let fav"
									class="actions-cell action-column">



									<button (click)="confirmDelete(fav.mapId, fav.mapData.map)"
										mat-button
										class="text-[#9b3f3f] !font-[900] !mx-1">
										<i class="fa-sharp fa-regular fa-trash sm:pr-2"></i>
										<span class="hidden sm:inline-block">Delete</span>
									</button>
								</mat-cell>
							</ng-container>



							<mat-header-row *matHeaderRowDef="['map', 'route']"></mat-header-row>
							<mat-row *matRowDef="let row; columns: ['map', 'route'];"></mat-row>
						</mat-table>
						<p *ngIf="!hasFavorites"
							class="m-4 text-neutral-100">
							No favorites yet...
						</p>
						<mat-paginator [pageSizeOptions]="[5, 10, 20]"
							[pageSize]="pageSize"
							[showFirstLastButtons]="true"
							(page)="onPageSizeChange($event)"></mat-paginator>
					</div>
				</div>
			</div>
		</div>
	</div>



	<div *ngIf="!isLoggedIn"
		class="p-5 bg-[#1c2537] rounded-md"
		style="border-left: 5px solid #a13c3c;">
		<div class="grid grid-cols-1 sm:grid-cols-[120px_minmax(900px,_1fr)_100px] grid-rows-2 sm:grid-rows-none">
			<div class="row-start-2 sm:row-start-auto">
				<button class="!my-4 bg-gradient-to-tr from-[#4b4a48]/80 to-[#a3a197]/80 opacity-[65%] !transition !duration-300 ease-in hover:opacity-[80%]"
					mat-button
					routerLink="/home">
					<i class="fa-solid fa-house mr-1.5"></i>
					Home
				</button>
			</div>



			<div class="row-start-1 sm:row-start-auto">
				<h3 class="text-xl my-2">
					Please login to continue
				</h3>
				<p>
					You must be logged in to access this content.
				</p>
			</div>
		</div>


	</div>
</div>
