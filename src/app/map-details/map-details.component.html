<div class="lg:w-[80vw] w-[100vw - 2em] m-auto mt-[2em] lg:mt-[3.5em]" id="map-contained">

    <div class="text-[#88887b]  text-3xl mb-[1em]">

        <div class="grid grid-cols-1 lg:grid-cols-2">
            <div class="col-start-1 col-span-1">
                {{currentMap.map}}
                <span class="text-slate-200/80 text-lg px-4 "><br>{{currentMap.campaign}} Map</span>
            </div>

            <div class="lg:col-start-2 col-start-1 col-span-1 place-self-end">

                <button mat-button class="block !text-[#9ea18a] !mr-2" [routerLink]="['/maps']">
                    <i class="fa-sharp fa-solid fa-arrow-left pr-2"></i> Back
                </button>
                <button mat-stroked-button [matMenuTriggerFor]="optMenu">
                    <i class="fa-solid fa-ellipsis-vertical pr-2"></i> More
                </button>

            </div>
        </div>

        <mat-menu #optMenu="matMenu" xPosition="before" class="bg-[#646258]/70 backdrop-blur-sm mt-[3px] !w-[200px]">


            <button *ngIf="showAdmin" class="!text-[#b9b8b0] opacity-40 font-[400]" mat-menu-item disabled><i
                    class="pr-2 fa-solid fa-pen-to-square"></i> Edit Map</button>


            <p *ngIf="showUser" class="text-[0.8rem] ml-2 text-[#8b8a82] select-none">Event Planner</p>
            <mat-divider *ngIf="showUser"></mat-divider>

            <button (click)="openDialog()" *ngIf="showUser" class="!text-[#b9b8b0]/80 font-[400]" mat-menu-item><i
                    class="pr-2 fa-solid fa-note"></i>
                Map Notes</button>

            <button *ngIf="showUser" class="!text-[#b9b8b0] opacity-40 font-[400]" mat-menu-item disabled><i
                    class="pr-2 fa-solid fa-plus"></i>
                Add to Event</button>
            <mat-divider *ngIf="showUser"></mat-divider>

            <button *ngIf="showUser" class="!text-[#b9b8b0] opacity-40 font-[400]" mat-menu-item disabled><i
                    class="pr-2 fa-regular fa-heart"></i> Favorite</button>

            <button
                (click)="openSnackBar(currentMap.map + ' share link copied to clipboard.', 6000);copyToClipboard('https://app.paarmy.com/beta/maps/' + currentMap.id)"
                class="!text-[#b9b8b0]/80 font-[400]" mat-menu-item><i
                    class="pr-2 fa-sharp fa-solid fa-share-nodes"></i> Share</button>

        </mat-menu>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 lg:grid-rows-3 lg:gap-0 rounded-lg lg:p-[2em] p-[1em] lg:!h-[70vh]"
        style="background: linear-gradient(180deg, #1e293b, #1e293b00);">


        <div class="w-full lg:col-start-1 lg:col-span-1 text-center lg:text-left lg:row-start-1 lg:row-span-3">

            <mat-slide-toggle (change)="toggle($event)" class="font-[200]">Flyover Cam</mat-slide-toggle>

            <img (click)="open('https://app.paarmy.com/' + currentMap.image , currentMap.map, 1500, 868)"
                *ngIf="!CamMapBool" src="https://app.paarmy.com/{{currentMap.image}}"
                class="fade-center transition-all active:!translate-y-2 active:translate-x-2 hover:cursor-pointer hover:brightness-[85%] brightness-75 sepia-[50%] lg:mr-auto mt-[1em] lg:w-[80%] lg:h-auto block rounded-lg shadow-none duration-300 ease-in-out hover:shadow-lg hover:shadow-black/30">

            <div *ngIf="CamMapBool" id="videoContainer"
                class="fade-center mb-[100px] lg:mr-auto mt-[1em] lg:w-[95%] lg:h-[62%] h-[75%] block rounded-lg shadow-none transition-shadow duration-300 ease-in-out hover:shadow-lg hover:shadow-black/30">
            </div>

        </div>





        <!--  -->

        <div class="lg:col-start-2 lg:col-span-1 lg:row-start-1 lg:row-span-3 text-slate-400 mt-[1em] lg:mt-[0]">


            <button *ngIf="showUser" style="z-index: 2;" class="float-right" mat-button
                (click)="open('https://stratsketch.com/' + currentMap.strat , currentMap.map, 1500, 868)">
                <i class="fa-sharp fa-regular fa-paintbrush-pencil pr-1"></i>StratSketch<sup><i
                        class="fa-sharp fa-regular fa-arrow-up-right-from-square pl-2"></i></sup>
            </button>

            <!-- <button style="z-index: 2;" class="!mr-[0.5em] float-right" mat-button (click)="openDialog()">
                <i class="fa-sharp fa-regular fa-paintbrush-pencil pr-1"></i>Map Notes
            </button> -->




            <div *ngFor="let unit of currentMap.ATTACKER; index as i;"
                class="lg:pt-[2em] lg:pl-[2em] lg:pr-[2em] p-[1em] rounded-t-3xl left-in"
                style="background: linear-gradient(130deg, #263855e1, #1e293b00, #1e293b00, #1e293b00);">

                <!-- <h3 class="text-white text-2xl pb-3  tracking-tight">{{unit.side}} - {{unit.stance}}</h3> -->

                <div class="text-[#88887b] font-serif text-3xl font-[900]"
                    style="filter: drop-shadow(3px 3px 8px #141414c2);">
                    {{unit.side}}
                    <span class="block text-lg">{{unit.stance}}</span>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-4 gap-10">
                    <div class="lg:col-start-1 lg:col-span-2">
                        <p *ngIf="unit.reg1" class="font-[400] mt-[1em] text-base text-slate-300">{{unit.reg1}}</p>
                        <div *ngIf="unit.reg1Weapons">
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg1Weapons[1]">{{unit.reg1Weapons[1]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg1Weapons[2]">{{unit.reg1Weapons[2]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg1Weapons[3]">{{unit.reg1Weapons[3]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg1Weapons[4]">{{unit.reg1Weapons[4]}}
                            </p>
                        </div>
                        <p *ngIf="unit.reg2" class="font-[400] mt-[1em] text-base text-slate-300">{{unit.reg2}}</p>
                        <div *ngIf="unit.reg2Weapons">
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg2Weapons[1]">{{unit.reg2Weapons[1]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg2Weapons[2]">{{unit.reg2Weapons[2]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg2Weapons[3]">{{unit.reg2Weapons[3]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg2Weapons[4]">{{unit.reg2Weapons[4]}}
                            </p>
                        </div>

                        <p *ngIf="unit.reg3" class="font-[400] mt-[1em] text-base text-slate-300">{{unit.reg3}}</p>
                        <div *ngIf="unit.reg3Weapons">
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg3Weapons[1]">{{unit.reg3Weapons[1]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg3Weapons[2]">{{unit.reg3Weapons[2]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg3Weapons[3]">{{unit.reg3Weapons[3]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg3Weapons[4]">{{unit.reg3Weapons[4]}}
                            </p>
                        </div>

                        <p *ngIf="unit.reg4" class="font-[400] mt-[1em] text-base text-slate-300">{{unit.reg4}}</p>
                        <div *ngIf="unit.reg4Weapons">
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg4Weapons[1]">{{unit.reg4Weapons[1]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg4Weapons[2]">{{unit.reg4Weapons[2]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg4Weapons[3]">{{unit.reg4Weapons[3]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg4Weapons[4]">{{unit.reg4Weapons[4]}}
                            </p>
                        </div>
                    </div>

                    <!--  -->

                    <div class="lg:col-start-3 col-span-2">
                        <div *ngIf="unit.arty1" class="skewed-textR !text-right">Artillery</div>
                        <div *ngIf="unit.arty1" class="pt-[1em] pr-[1em] !text-right"
                            style="border-right: dotted 1px #7c7d738f;">
                            <p *ngIf="unit.arty1" class="font-[400] text-sm text-slate-300">{{unit.arty1}}</p>
                            <div *ngIf="unit.arty1Weapons">
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty1Weapons[1]">
                                    {{unit.arty1Weapons[1]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty1Weapons[2]">
                                    {{unit.arty1Weapons[2]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty1Weapons[3]">
                                    {{unit.arty1Weapons[3]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty1Weapons[4]">
                                    {{unit.arty1Weapons[4]}}</p>
                            </div>

                            <p *ngIf="unit.arty2" class="font-[400] text-sm text-slate-300 mt-[0.5em]">{{unit.arty2}}
                            </p>
                            <div *ngIf="unit.arty2Weapons">
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty2Weapons[1]">
                                    {{unit.arty2Weapons[1]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty2Weapons[2]">
                                    {{unit.arty2Weapons[2]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty2Weapons[3]">
                                    {{unit.arty2Weapons[3]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty2Weapons[4]">
                                    {{unit.arty2Weapons[4]}}</p>
                            </div>

                            <p *ngIf="unit.arty3" class="font-[400] text-sm text-slate-300 mt-[0.5em]">{{unit.arty3}}
                            </p>
                            <div *ngIf="unit.arty3Weapons">
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty3Weapons[1]">
                                    {{unit.arty3Weapons[1]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty3Weapons[2]">
                                    {{unit.arty3Weapons[2]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty3Weapons[3]">
                                    {{unit.arty3Weapons[3]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty3Weapons[4]">
                                    {{unit.arty3Weapons[4]}}</p>
                            </div>

                            <p *ngIf="unit.arty4" class="font-[400] text-sm text-slate-300 mt-[0.5em]">{{unit.arty4}}
                            </p>
                            <div *ngIf="unit.arty4Weapons">
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty4Weapons[1]">
                                    {{unit.arty4Weapons[1]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty4Weapons[2]">
                                    {{unit.arty4Weapons[2]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty4Weapons[3]">
                                    {{unit.arty4Weapons[3]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty4Weapons[4]">
                                    {{unit.arty4Weapons[4]}}</p>
                            </div>
                        </div>
                    </div>
                </div>






            </div>

            <div class="block pr-[20px] text-center text-3xl font-[300] select-none">
                <i class="icon fa-light fa-swords text-[2rem]"></i>
                <span class="block text-sm font-[200]">vs.</span>
            </div>


            <div *ngFor="let unit of currentMap.DEFENDER; index as i;"
                class="lg:pb-[2em] lg:pr-[2em] lg:pl-[2em] p-[1em] rounded-b-3xl text-right right-in"
                style="background: linear-gradient(-25deg, #263855e1, #1e293b00, #1e293b00, #1e293b00);">
                <!-- <h3 class="text-white text-2xl pb-3  tracking-tight">{{unit.side}} - {{unit.stance}}</h3> -->

                <div class="text-[#88887b] font-serif text-3xl font-[900]"
                    style="filter: drop-shadow(3px 3px 8px #141414c2);">
                    {{unit.side}}
                    <span class="block text-lg">{{unit.stance}}</span>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-4 lg:gap-10">

                    <div class="col-start-1 col-span-2">
                        <div *ngIf="unit.arty1" class="skewed-text !text-left">Artillery</div>
                        <div *ngIf="unit.arty1" class="pt-[1em] pl-[1em] !text-left"
                            style="border-left: dotted 1px #7c7d738f;">
                            <p *ngIf="unit.arty1" class="font-[400] text-sm text-slate-300">{{unit.arty1}}</p>
                            <div *ngIf="unit.arty1Weapons">
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty1Weapons[1]">
                                    {{unit.arty1Weapons[1]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty1Weapons[2]">
                                    {{unit.arty1Weapons[2]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty1Weapons[3]">
                                    {{unit.arty1Weapons[3]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty1Weapons[4]">
                                    {{unit.arty1Weapons[4]}}</p>
                            </div>

                            <p *ngIf="unit.arty2" class="font-[400] text-sm text-slate-300 mt-[0.5em]">{{unit.arty2}}
                            </p>
                            <div *ngIf="unit.arty2Weapons">
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty2Weapons[1]">
                                    {{unit.arty2Weapons[1]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty2Weapons[2]">
                                    {{unit.arty2Weapons[2]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty2Weapons[3]">
                                    {{unit.arty2Weapons[3]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty2Weapons[4]">
                                    {{unit.arty2Weapons[4]}}</p>
                            </div>

                            <p *ngIf="unit.arty3" class="font-[400] text-sm text-slate-300 mt-[0.5em]">{{unit.arty3}}
                            </p>
                            <div *ngIf="unit.arty3Weapons">
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty3Weapons[1]">
                                    {{unit.arty3Weapons[1]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty3Weapons[2]">
                                    {{unit.arty3Weapons[2]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty3Weapons[3]">
                                    {{unit.arty3Weapons[3]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty3Weapons[4]">
                                    {{unit.arty3Weapons[4]}}</p>
                            </div>

                            <p *ngIf="unit.arty4" class="font-[400] text-sm text-slate-300 mt-[0.5em]">{{unit.arty4}}
                            </p>
                            <div *ngIf="unit.arty4Weapons">
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty4Weapons[1]">
                                    {{unit.arty4Weapons[1]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty4Weapons[2]">
                                    {{unit.arty4Weapons[2]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty4Weapons[3]">
                                    {{unit.arty4Weapons[3]}}</p>
                                <p class="text-sm p-1 weapon-class" *ngIf="unit.arty4Weapons[4]">
                                    {{unit.arty4Weapons[4]}}</p>
                            </div>
                        </div>
                    </div>

                    <!--  -->
                    <div class="lg:col-start-3 lg:col-span-2">

                        <p *ngIf="unit.reg1" class="font-[400] mt-[1em] text-base text-slate-300">{{unit.reg1}}</p>
                        <div *ngIf="unit.reg1Weapons">
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg1Weapons[1]">{{unit.reg1Weapons[1]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg1Weapons[2]">{{unit.reg1Weapons[2]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg1Weapons[3]">{{unit.reg1Weapons[3]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg1Weapons[4]">{{unit.reg1Weapons[4]}}
                            </p>
                        </div>
                        <p *ngIf="unit.reg2" class="font-[400] mt-[1em] text-base text-slate-300">{{unit.reg2}}</p>
                        <div *ngIf="unit.reg2Weapons">
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg2Weapons[1]">{{unit.reg2Weapons[1]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg2Weapons[2]">{{unit.reg2Weapons[2]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg2Weapons[3]">{{unit.reg2Weapons[3]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg2Weapons[4]">{{unit.reg2Weapons[4]}}
                            </p>
                        </div>

                        <p *ngIf="unit.reg3" class="font-[400] mt-[1em] text-base text-slate-300">{{unit.reg3}}</p>
                        <div *ngIf="unit.reg3Weapons">
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg3Weapons[1]">{{unit.reg3Weapons[1]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg3Weapons[2]">{{unit.reg3Weapons[2]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg3Weapons[3]">{{unit.reg3Weapons[3]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg3Weapons[4]">{{unit.reg3Weapons[4]}}
                            </p>
                        </div>

                        <p *ngIf="unit.reg4" class="font-[400] mt-[1em] text-base text-slate-300">{{unit.reg4}}</p>
                        <div *ngIf="unit.reg4Weapons">
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg4Weapons[1]">{{unit.reg4Weapons[1]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg4Weapons[2]">{{unit.reg4Weapons[2]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg4Weapons[3]">{{unit.reg4Weapons[3]}}
                            </p>
                            <p class="text-sm p-1 ml-4 weapon-class" *ngIf="unit.reg4Weapons[4]">{{unit.reg4Weapons[4]}}
                            </p>
                        </div>
                    </div>



                </div>

            </div>

        </div>

        <!--  -->



    </div>
</div>

<ng-template #dialogTemplate>
    <div class="notes-dialog" cdkDrag cdkDragRootElement=".cdk-overlay-pane">
        <div cdkDragHandle class="py-2 bg-slate-700 grid grid-cols-2">
            <div class="col-start-1 text-left pl-2">
                Map Notes
            </div>
            <div class="col-start-2 text-right pr-2">
                <i class="fa-sharp fa-solid fa-xmark-large cursor-pointer hover:opacity-75" (click)="closePopup()"></i>
            </div>
        </div>
        <div class="container">
            <textarea placeholder="No notes found.." #notesTextarea>{{currentNotes}}</textarea>
        </div>
        <div class="text-right pt-[27px] mr-[1em]">
            <button mat-button class="!text-[#c24646] !mr-2" (click)="closePopup()">Close</button>
            <button mat-stroked-button class="!text-[#afaf9b]" (click)="saveNotes(notesTextarea.value, currentMap.id)">Save</button>
        </div>
    </div>
</ng-template>
